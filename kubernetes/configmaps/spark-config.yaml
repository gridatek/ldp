---
apiVersion: v1
kind: ConfigMap
metadata:
  name: spark-config
  namespace: ldp
data:
  spark-defaults.conf: |
    spark.master                     spark://spark-master-svc:7077
    spark.eventLog.enabled           true
    spark.eventLog.dir               s3a://warehouse/spark-events/
    spark.history.fs.logDirectory    s3a://warehouse/spark-events/

    # S3/MinIO Configuration
    spark.hadoop.fs.s3a.endpoint              http://minio:9000
    spark.hadoop.fs.s3a.access.key            admin
    spark.hadoop.fs.s3a.secret.key            minioadmin
    spark.hadoop.fs.s3a.path.style.access     true
    spark.hadoop.fs.s3a.impl                  org.apache.hadoop.fs.s3a.S3AFileSystem
    spark.hadoop.fs.s3a.connection.ssl.enabled false

    # Iceberg Configuration
    spark.sql.extensions                org.apache.iceberg.spark.extensions.IcebergSparkSessionExtensions
    spark.sql.catalog.spark_catalog     org.apache.iceberg.spark.SparkSessionCatalog
    spark.sql.catalog.spark_catalog.type hive
    spark.sql.catalog.local             org.apache.iceberg.spark.SparkCatalog
    spark.sql.catalog.local.type        hadoop
    spark.sql.catalog.local.warehouse   s3a://warehouse/

  log4j.properties: |
    log4j.rootCategory=INFO, console
    log4j.appender.console=org.apache.log4j.ConsoleAppender
    log4j.appender.console.target=System.err
    log4j.appender.console.layout=org.apache.log4j.PatternLayout
    log4j.appender.console.layout.ConversionPattern=%d{yy/MM/dd HH:mm:ss} %p %c{1}: %m%n

    # Reduce logging for specific packages
    log4j.logger.org.apache.spark.repl.Main=WARN
    log4j.logger.org.spark_project.jetty=WARN
    log4j.logger.org.spark_project.jetty.util.component.AbstractLifeCycle=ERROR
    log4j.logger.org.apache.spark.repl.SparkIMain$exprTyper=INFO
    log4j.logger.org.apache.spark.repl.SparkILoop$SparkILoopInterpreter=INFO
    log4j.logger.org.apache.parquet=ERROR
    log4j.logger.parquet=ERROR
